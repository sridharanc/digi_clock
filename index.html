import React, { useState, useRef, useEffect } from 'react';
import { ChevronDown, ChevronRight } from 'lucide-react';

const MegaDropdown = () => {
  const [isOpen, setIsOpen] = useState(false);
  const [selectedCountry, setSelectedCountry] = useState('United States');
  const [selectedState, setSelectedState] = useState(null);
  const [selectedCity, setSelectedCity] = useState(null);
  const [hoveredCountry, setHoveredCountry] = useState('United States');
  const [hoveredState, setHoveredState] = useState(null);
  const [hoveredCity, setHoveredCity] = useState('');
  
  const dropdownRef = useRef(null);

  const data = {
    'United States': {
      'California': ['Los Angeles', 'San Francisco', 'San Diego', 'Sacramento'],
      'New York': ['New York City', 'Buffalo', 'Albany', 'Rochester'],
      'Texas': ['Houston', 'Dallas', 'Austin', 'San Antonio'],
      'Florida': ['Miami', 'Orlando', 'Tampa', 'Jacksonville'],
      'Illinois': ['Chicago', 'Springfield', 'Rockford', 'Peoria']
    }
  };

  const countries = Object.keys(data);
  const states = data[hoveredCountry] ? Object.keys(data[hoveredCountry]) : [];
  const cities = data[hoveredCountry] && data[hoveredCountry][hoveredState] 
    ? data[hoveredCountry][hoveredState] 
    : [];

  useEffect(() => {
    const handleClickOutside = (event) => {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
        setIsOpen(false);
      }
    };

    document.addEventListener('mousedown', handleClickOutside);
    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
    };
  }, []);

  const handleCountrySelect = (country) => {
    setSelectedCountry(country);
    setSelectedState(null);
    setSelectedCity(null);
    setIsOpen(false);
  };

  const handleCountryNavigate = (country, e) => {
    e.stopPropagation();
    setHoveredCountry(country);
    setHoveredState(null);
  };

  const handleStateSelect = (state) => {
    setSelectedState(state);
    setSelectedCity(null);
    setIsOpen(false);
  };

  const handleStateNavigate = (state, e) => {
    e.stopPropagation();
    setHoveredState(state);
  };

  const handleCitySelect = (city) => {
    setSelectedCity(city);
    setIsOpen(false);
  };

  const getDisplayLabel = () => {
    if (selectedCity) {
      return `${selectedCity}, ${selectedState}, ${selectedCountry}`;
    } else if (selectedState) {
      return `${selectedState}, ${selectedCountry}`;
    } else if (selectedCountry) {
      return selectedCountry;
    }
    return 'Select Location';
  };

  return (
    <div className="w-full max-w-md mx-auto p-8" ref={dropdownRef}>
      <label className="block text-sm font-medium text-gray-700 mb-2">
        Location
      </label>
      
      {/* Dropdown Trigger */}
      <div 
        className="relative w-full bg-white border border-gray-300 rounded-lg px-3 py-2 cursor-pointer flex items-center justify-between hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        onClick={() => setIsOpen(!isOpen)}
      >
        <span className="text-gray-900 truncate">{getDisplayLabel()}</span>
        <ChevronDown className={`w-5 h-5 text-gray-400 transition-transform ${isOpen ? 'rotate-180' : ''}`} />
      </div>

      {/* Mega Dropdown */}
      {isOpen && (
        <div className="absolute z-50 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg">
          <div className="flex" style={{ width: '600px', height: '300px' }}>
            
            {/* Column 1: Countries */}
            <div className="w-1/3 border-r border-gray-200">
              <div className="p-3 bg-gray-50 border-b border-gray-200">
                <h3 className="text-sm font-semibold text-gray-700">Country</h3>
              </div>
              <div className="overflow-y-auto" style={{ height: '260px' }}>
                {countries.map((country) => (
                  <div
                    key={country}
                    className={`px-3 py-2 cursor-pointer flex items-center justify-between group transition-colors ${
                      selectedCountry === country 
                        ? 'bg-blue-50 text-blue-700 border-r-2 border-blue-500' 
                        : hoveredCountry === country
                        ? 'bg-gray-50'
                        : 'hover:bg-gray-50'
                    }`}
                    onClick={() => handleCountrySelect(country)}
                    onMouseEnter={() => setHoveredCountry(country)}
                  >
                    <span className="text-sm flex-1">{country}</span>
                    <ChevronRight 
                      className={`w-4 h-4 text-gray-400 transition-opacity cursor-pointer hover:text-gray-600 ${
                        selectedCountry === country || hoveredCountry === country 
                          ? 'opacity-100' 
                          : 'opacity-0 group-hover:opacity-100'
                      }`}
                      onClick={(e) => handleCountryNavigate(country, e)}
                    />
                  </div>
                ))}
              </div>
            </div>

            {/* Column 2: States */}
            <div className="w-1/3 border-r border-gray-200">
              <div className="p-3 bg-gray-50 border-b border-gray-200">
                <h3 className="text-sm font-semibold text-gray-700">State</h3>
              </div>
              <div className="overflow-y-auto" style={{ height: '260px' }}>
                {states.map((state) => (
                  <div
                    key={state}
                    className={`px-3 py-2 cursor-pointer flex items-center justify-between group transition-colors ${
                      selectedState === state 
                        ? 'bg-blue-50 text-blue-700 border-r-2 border-blue-500' 
                        : hoveredState === state
                        ? 'bg-gray-50'
                        : 'hover:bg-gray-50'
                    }`}
                    onClick={() => handleStateSelect(state)}
                    onMouseEnter={() => setHoveredState(state)}
                  >
                    <span className="text-sm flex-1">{state}</span>
                    <ChevronRight 
                      className={`w-4 h-4 text-gray-400 transition-opacity cursor-pointer hover:text-gray-600 ${
                        selectedState === state || hoveredState === state 
                          ? 'opacity-100' 
                          : 'opacity-0 group-hover:opacity-100'
                      }`}
                      onClick={(e) => handleStateNavigate(state, e)}
                    />
                  </div>
                ))}
              </div>
            </div>

            {/* Column 3: Cities */}
            <div className="w-1/3">
              <div className="p-3 bg-gray-50 border-b border-gray-200">
                <h3 className="text-sm font-semibold text-gray-700">City</h3>
              </div>
              <div className="overflow-y-auto" style={{ height: '260px' }}>
                {cities.map((city) => (
                  <div
                    key={city}
                    className={`px-3 py-2 cursor-pointer flex items-center justify-between group transition-colors ${
                      selectedCity === city 
                        ? 'bg-blue-50 text-blue-700' 
                        : 'hover:bg-gray-50'
                    }`}
                    onClick={() => handleCitySelect(city)}
                    onMouseEnter={() => setHoveredCity(city)}
                    onMouseLeave={() => setHoveredCity('')}
                  >
                    <span className="text-sm flex-1">{city}</span>
                    <ChevronRight className={`w-4 h-4 text-gray-400 transition-opacity ${
                      selectedCity === city || hoveredCity === city 
                        ? 'opacity-100' 
                        : 'opacity-0 group-hover:opacity-100'
                    }`} />
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default MegaDropdown;
